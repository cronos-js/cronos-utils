#!/usr/bin/env node
var E=Object.create;var v=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var _=(s,o,r,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let e of P(o))!T.call(s,e)&&e!==r&&v(s,e,{get:()=>o[e],enumerable:!(n=F(o,e))||n.enumerable});return s};var g=(s,o,r)=>(r=s!=null?E(I(s)):{},_(o||!s||!s.__esModule?v(r,"default",{value:s,enumerable:!0}):r,s));var h=require("child_process");var A=async s=>{switch(console.clear(),console.log("\x1B[33m\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\x1B[37m"),s){case"build":console.log("    \x1B[33m\x1B[1m\x1B[37mCronos Build \u{1F525}  \x1B[0m\x1B[31m");break;case"watch":console.log("    \x1B[33m\x1B[1m\x1B[37mCronos Watch \u{1F525}  \x1B[0m\x1B[31m");break;case"preview":console.log("   \x1B[33m\x1B[1m\x1B[37mCronos Preview \u{1F525}  \x1B[0m\x1B[31m");break;default:break}console.log("\x1B[33m\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\x1B[37m")},k=A;var p=g(require("os")),c=g(require("fs"));var u=g(require("fs")),y=s=>{let o=u.default.existsSync("src/index.ts"),r=u.default.existsSync("src/index.js");!o&&!r?(console.log("[\u274C] index.ts or index.js not found in src folder."),process.exit(1)):s(o)};var w=process.argv.slice(2),S=w[0],R=p.default.platform()==="win32"||p.default.platform()==="win64";if(S=="--express")y(s=>{nodemonComand=s?["nodemon","--exec","ts-node","src/index.ts"]:["nodemon","src/index.js"],(0,h.spawn)(R?"npx.cmd":"npx",nodemonComand,{stdio:"inherit"})});else if(S=="--react"||S=="--vue"){let s=!1,o="localhost",r=5173;if(c.default.existsSync("Rspack.config.js")){let e=c.default.readFileSync("Rspack.config.js","utf8"),t=/devServer:\s*{[\s\S]*?}/,i=e.match(t);if(i){let f=i[0],d=/host:\s*['"]\S+['"]/,l=/port:\s*\d+/,a=f.match(d),m=f.match(l);if(a?o=a[0].split(":")[1].trim().replace(/['"]/g,""):(e=e.replace(/devServer:\s*{/,`devServer: {
   host: "`+o+'",'),s=!0,c.default.writeFileSync("Rspack.config.js",e)),m)r=m[0].split(":")[1].trim();else{let x=5173;e=e.replace(/devServer:\s*{/,`devServer: {
   port: `+x+","),s=!0,c.default.writeFileSync("Rspack.config.js",e)}}}w.forEach(e=>{if(e.includes("host")){o=e.split("=")[1];let t=c.default.readFileSync("Rspack.config.js","utf8");t=t.replace(/host:\s*['"]\S+['"]/,'host: "'+o+'"'),c.default.writeFileSync("Rspack.config.js",t)}if(e.includes("port")){r=e.split("=")[1];let t=c.default.readFileSync("Rspack.config.js","utf8");t=t.replace(/port:\s*\d+/,"port: "+r),c.default.writeFileSync("Rspack.config.js",t)}}),console.clear(),console.log(`\u{1F980}  \x1B[31m\x1B[1mRspack\x1B[0m\x1B[37m is starting...
`);let n=(0,h.spawn)(R?"npx.cmd":"npx",["Rspack","serve"]);n.stderr.on("data",e=>{console.error(`${e}`)}),n.stdout.on("data",e=>{H(e,o,r)}),n.on("error",e=>{console.error(`${e.message}`)})}var H=(s,o,r)=>{k("watch");let n=s.toString(),e=/in(.*)/,t=/error(.*)/,i=n.match(e);if(n.match(t))console.log(s.toString());else if(i){console.log("\u{1F980} \x1B[31m\x1B[1mRspack\x1B[0m\x1B[37m ready in:\x1B[33m\x1B[1m"+i[1]+"\x1B[0m\x1B[37m");let d=()=>{let l=p.default.networkInterfaces(),a=[];for(let m in l)for(let x=0;x<l[m].length;x++){let b=l[m][x],j=b.address,C=b.family,D=b.internal;C==="IPv4"&&!D&&a.push(j)}return a};o==="0.0.0.0"?(console.log(`\u{1F680} Server running on:
`),d().forEach(function(l){console.log("  \u2192  \x1B[36m\x1B[1mhttp://".concat(l,":").concat(r,"\x1B[37m"))})):console.log("\u{1F680} Server running on \x1B[36m\x1B[1mhttp://".concat(o,":").concat(r).concat("\x1B[37m"))}};
