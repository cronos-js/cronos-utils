#!/usr/bin/env node
var E=Object.create;var S=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty;var _=(o,s,r,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let e of I(s))!F.call(o,e)&&e!==r&&S(o,e,{get:()=>s[e],enumerable:!(t=P(s,e))||t.enumerable});return o};var g=(o,s,r)=>(r=o!=null?E(T(o)):{},_(s||!o||!o.__esModule?S(r,"default",{value:o,enumerable:!0}):r,o));var h=require("child_process");var A=async o=>{switch(console.clear(),console.log("\x1B[33m\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\x1B[37m"),o){case"build":console.log("    \x1B[33m\x1B[1m\x1B[37mCronos Build \u{1F525}  \x1B[0m\x1B[31m");break;case"watch":console.log("    \x1B[33m\x1B[1m\x1B[37mCronos Watch \u{1F525}  \x1B[0m\x1B[31m");break;case"preview":console.log("   \x1B[33m\x1B[1m\x1B[37mCronos Preview \u{1F525}  \x1B[0m\x1B[31m");break;default:break}console.log("\x1B[33m\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\x1B[37m")},k=A;var a=g(require("os")),x=g(require("fs"));var u=g(require("fs")),y=o=>{let s=u.default.existsSync("src/index.ts"),r=u.default.existsSync("src/index.js");!s&&!r?(console.log("[\u274C] index.ts or index.js not found in src folder."),process.exit(1)):o(s)};var R=process.argv.slice(2),v=R[0],w=a.default.platform()==="win32"||a.default.platform()==="win64";if(v=="--express")y(o=>{nodemonComand=o?["nodemon","--exec","ts-node","src/index.ts"]:["nodemon","src/index.js"],(0,h.spawn)(w?"npx.cmd":"npx",nodemonComand,{stdio:"inherit"})});else if(v=="--react"||v=="--vue"){let o=!1,s="localhost",r=5173;if(x.default.existsSync("Rspack.config.js")){let e=x.default.readFileSync("Rspack.config.js","utf8"),p=/devServer:\s*{[\s\S]*?}/,c=e.match(p);if(c){let d=c[0],f=/host:\s*['"]\S+['"]/,n=/port:\s*\d+/,l=d.match(f),i=d.match(n);if(l?s=l[0].split(":")[1].trim().replace(/['"]/g,""):(e=e.replace(/devServer:\s*{/,`devServer: {
   host: "`+s+'",'),o=!0,x.default.writeFileSync("Rspack.config.js",e)),i)r=i[0].split(":")[1].trim();else{let m=5173;e=e.replace(/devServer:\s*{/,`devServer: {
   port: `+m+","),o=!0,x.default.writeFileSync("Rspack.config.js",e)}}}R.forEach(e=>{e.includes("host")&&(s=e.split("=")[1]),e.includes("port")&&(r=e.split("=")[1])}),console.clear(),console.log(`\u{1F980}  \x1B[31m\x1B[1mRspack\x1B[0m\x1B[37m is starting...
`);let t=(0,h.spawn)(w?"npx.cmd":"npx",["Rspack","serve"]);t.stderr.on("data",e=>{console.error(`${e}`)}),t.stdout.on("data",e=>{H(e,s,r)}),t.on("error",e=>{console.error(`${e.message}`)})}var H=(o,s,r)=>{k("watch");let t=o.toString(),e=/in(.*)/,p=/error(.*)/,c=t.match(e);if(t.match(p))console.log(o.toString());else if(c){console.log("\u{1F980} \x1B[31m\x1B[1mRspack\x1B[0m\x1B[37m ready in:\x1B[33m\x1B[1m"+c[1]+"\x1B[0m\x1B[37m");let f=()=>{let n=a.default.networkInterfaces(),l=[];for(let i in n)for(let m=0;m<n[i].length;m++){let b=n[i][m],C=b.address,j=b.family,D=b.internal;j==="IPv4"&&!D&&l.push(C)}return l};s==="0.0.0.0"?(console.log(`\u{1F680} Server running on:
`),f().forEach(function(n){console.log("  \u2192  \x1B[36m\x1B[1mhttp://".concat(n,":").concat(r,"\x1B[37m"))})):console.log("\u{1F680} Server running on \x1B[36m\x1B[1mhttp://".concat(s,":").concat(r).concat("\x1B[37m"))}};
